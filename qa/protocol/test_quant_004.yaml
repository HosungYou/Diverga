# Diverga QA Protocol v3.2
# Scenario QUANT-004: Hybrid Checkpoint Detection Test (Korean)
#
# Purpose: Test the hybrid checkpoint detection system that handles both:
# 1. Formal CP_XXX identifiers
# 2. Descriptive checkpoint names (mapped via CHECKPOINT_ALIASES)
#
# This scenario uses Korean prompts to test bilingual checkpoint detection.
#
# Complexity: MEDIUM (4-6 turns expected)
# Language: Korean
# CLI: Claude Code, Codex

scenario_id: QUANT-004
name: "Hybrid Checkpoint Detection - Korean Meta-Analysis"
version: "3.2"
paradigm: quantitative
complexity_level: MEDIUM

# VERIFICATION HUDDLE
verification_huddle:
  enabled: true
  markers:
    - type: NO_SIMULATION_MARKERS
    - type: RESPONSE_LENGTH_VARIANCE
    - type: TIMESTAMP_VARIANCE
    - type: CONTEXT_AWARENESS
    - type: UNIQUE_SESSION_ID
    - type: DYNAMIC_CONTENT

agents_involved:
  - A1-ResearchQuestionRefiner
  - B3-EffectSizeExtractor
  - C5-MetaAnalysisMaster
  - E1-QuantitativeAnalysisGuide

language: "Korean"
expected_turns: 4-6
expected_technical_questions: 1
expected_methodological_challenges: 1

checkpoints_expected:
  - id: CP_PARADIGM_CONFIRMATION
    level: RED
    mandatory_halt: true
    aliases:
      - "Paradigm Confirmation"
      - "패러다임 확인"

  - id: CP_EFFECT_SIZE_SELECTION
    level: ORANGE
    mandatory_halt: false
    aliases:
      - "Effect Size Target Selection"
      - "Effect Size Selection"
      - "효과크기 선택"

  - id: CP_MODERATOR_ANALYSIS
    level: ORANGE
    mandatory_halt: false
    aliases:
      - "Moderator Analysis Strategy"
      - "Moderator Strategy"
      - "조절변수 분석"

  - id: CP_METHODOLOGY_APPROVAL
    level: RED
    mandatory_halt: true
    aliases:
      - "Methodology Approval"
      - "방법론 승인"

conversation_flow:
  - turn: 1
    user_type: INITIAL_REQUEST
    user: |
      AI 튜터링 시스템이 학생 성취도에 미치는 효과에 대한 메타분석을 수행하려고 합니다.
      20개의 연구에서 다양한 효과크기(Cohen's d, Hedges' g, 상관계수 r)가 보고되어 있습니다.
      어떤 효과크기 지표로 통일해야 할까요?

    expected_behavior:
      paradigm_detection: quantitative
      keyword_triggers:
        - "메타분석"
        - "효과크기"
        - "Cohen's d"
        - "Hedges' g"
      checkpoint: CP_PARADIGM_CONFIRMATION
      language: Korean
      halt: true
      vs_options_min: 2
      discusses:
        - "효과크기 변환"
        - "Hedges' g vs Cohen's d"
        - "표본 크기 편향 보정"

  - turn: 2
    user_type: TECHNICAL_FOLLOW_UP
    user: |
      Hedges' g를 사용하겠습니다. 그런데 일부 연구는 F값만 보고하고 있어요.
      F통계량에서 Hedges' g로 어떻게 변환하나요?

    expected_behavior:
      provides_formula: true
      discusses:
        - "F to d conversion"
        - "degrees of freedom"
        - "변환 공식"
      checkpoint: CP_EFFECT_SIZE_SELECTION
      language: Korean

  - turn: 3
    user_type: METHODOLOGICAL_CHALLENGE
    user: |
      효과크기를 추출했는데 이질성이 높게 나왔어요 (I² = 75%).
      랜덤효과 모형을 사용해야 하나요? 조절변수 분석은 어떻게 해야 할까요?

    expected_behavior:
      honest_assessment: true
      discusses:
        - "I² 해석"
        - "랜덤효과 모형"
        - "조절변수 분석"
        - "메타회귀"
      provides_recommendation: true
      checkpoint: CP_MODERATOR_ANALYSIS
      language: Korean

  - turn: 4
    user_type: APPROVAL
    user: |
      감사합니다. Hedges' g를 사용하고, 랜덤효과 모형으로 분석하며,
      학습 유형(개별/협동)과 피드백 유형(즉각/지연)을 조절변수로 검토하겠습니다.
      분석 계획을 정리해 주세요.

    expected_behavior:
      final_approval: true
      generates_summary: true
      suggests_tools:
        - "metafor"
        - "R"
      checkpoint: CP_METHODOLOGY_APPROVAL
      language: Korean

validation_rules:
  checkpoint_compliance:
    target: 75%
    red_checkpoints_must_halt: true

  hybrid_detection:
    test_formal_cp: true
    test_descriptive_names: true
    test_korean_aliases: true

  language_consistency:
    input_language: Korean
    response_language: Korean
    must_match: true

  verification_huddle:
    no_dry_run_markers: true
    no_simulation_markers: true
    response_variance_required: true

metrics_targets:
  total_turns: ">=4"
  checkpoint_compliance: ">=75%"
  language_consistency: "100%"
  verification_huddle_pass: true
  hybrid_detection_test: true

# Hybrid Detection Test Focus
# This scenario specifically tests:
# 1. Formal CP_ checkpoints (CP_PARADIGM_CONFIRMATION)
# 2. Descriptive English names (Effect Size Target Selection)
# 3. Korean aliases (효과크기 선택, 조절변수 분석)
# 4. Alias mapping from CHECKPOINT_ALIASES dict
